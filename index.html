<html>
  <head>
    <title>Countdown generator - quictic</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
    
    <script src="/js/date.js"></script>
    
    <style type="text/css">
     body {
      font-family: Arial;
      margin: 0;
      background-color: #fff;
      
      background-image: url(img/debut_dark.png);
      background-repeat: repeat;
     }
     
     #body {
      margin: 0 auto;
      margin-top: 10%;
      padding: 20px;
      
      text-align: center;
      border: 1px solid black;
      background: rgba(255, 255, 255, .15);
     }
     
     #fields {
	  display: inline-block;
	 }
	 
	 #btn {
	  display: inline-block;
	  vertical-align: top;
      margin: 10px 0 0 20px;
      padding: 13px;
	  
      width: 200px;
	  height: 90px;
	  
	  font-size: 1em;
	  border: 1px solid black;
	 }
     
     input {
      display: block;
      margin: 0 auto;
     }

     input[type=text] {
      font-size: 1.2em;
      width: 450px;
      height: 40px;
      
      border: 1px solid #333;
      
      margin: 10px;
      padding: 5px;
     }
     
     #error {
      background-color: #FFD1D9;
      border: 1px solid red;
      padding: 3px;
      display: none;
     }
     
     .ui-tooltip {
	  font-size: .8em;
	  width: 500px;
	 }
    </style>
    
    <script type="text/javascript">
	 $(document).ready(function() {
	  $('#when').tooltip({
	   content: "What are you counting down to? Examples: <i>12/31/2013</i>, <i>Next Friday</i>, or <i>Christmas</i>.</ul>",
	   position:  {
		my: 'left bottom+55',
		at: 'left bottom'
	   },
	   opacity: 0.9
	  });
	 });    
    /**
     * This function checks for known cases that DateJS misses.
     *
     * Returns either a DateJS date object or null if the text
     * can't be parsed correctly.
     */
     function fallback(text) {
	  text = text.toLowerCase();
      text = text.replace(/Christmas/g, '12/25');
      
      return Date.parse(text);
     }
     
     function error() {
      $('#when').css('border', '1px solid red');
      $('#when').css('background-color', '#FFD9DD');
     }
     
     function clear_error() {
      $('#when').css('border', '1px solid #333');
      $('#when').css('background-color', '#fff');
	 }
     
     function countdown() {
      var title = $('#title').val();
      var when = $('#when').val();
      var style = 'a';
       
      var parsed = Date.parse(when)
      // Check to see if the date could be parsed. If not, try the fallback parsing.
      if (parsed == null) {
       parsed = fallback(when);
       // If fallback parsing fails, we have to throw an error.
       if (parsed == null) error();
      }
      else {
       clear_error();
       console.log(title);
       console.log(parsed);
       
       var us = parsed.toString('yyyyMMdd@HHmmss');
       var url = 'http://quictic.com/' + style + '/' + us + '/' + title;
       
       // Change the window location.
       window.location.href = url;
      }
     }
    </script>
  </head>
  <body>
   <div id="body">
    <div id="fields">
     <input type="text" id="title" placeholder="Countdown name" />
     <input type="text" id="when" title="Testing" placeholder="Countdown to..." />
    </div>
    <input type="button" id="btn" onclick="countdown()" value="Create" />
   </div>
   
   <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37464806-1']);
    _gaq.push(['_trackPageview']);

    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

   </script>
  </body>
</html>
